#!/bin/bash

# Pre-commit hook to run tests before committing
# This ensures code quality and prevents broken commits

echo "ğŸ§ª Running tests before commit..."
echo ""

# Run format check
echo "ğŸ“ Checking code formatting..."
npm run format:check
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Format check failed. Run 'npm run format' to fix formatting issues."
  exit 1
fi

# Run linter
echo ""
echo "ğŸ” Running linter..."
npm run lint
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Linting failed. Fix the issues above before committing."
  exit 1
fi

# Compile TypeScript
echo ""
echo "ğŸ”¨ Compiling TypeScript..."
npm run compile
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ TypeScript compilation failed. Fix the errors above before committing."
  exit 1
fi

# Run tests
echo ""
echo "ğŸ§ª Running tests..."
npm test
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Tests failed. Fix the failing tests before committing."
  echo ""
  echo "ğŸ’¡ Tip: If tests are timing out or hanging, you may need to:"
  echo "   - Close any running VS Code instances testing the extension"
  echo "   - Kill any hanging test processes"
  echo "   - Run tests again"
  exit 1
fi

echo ""
echo "âœ… All checks passed! Proceeding with commit."
echo ""
